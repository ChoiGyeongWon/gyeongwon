<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<meta http-equiv='X-UA-Compatible' content='IE=edge'>
	<title>sample</title>
	<meta name='viewport' content='width=device-width, initial-scale=1'>
	<link rel='stylesheet' type='text/css' media='screen' href='css/main.css'>
	<link rel='stylesheet' type='text/css' media='screen' href='css/slider.css'>
	<link rel='stylesheet' type='text/css' media='screen' href='css/settings.css'>
    <style>
        .slider-navbar {
            display: none;
        }
        body {
            max-width: 480px;
            width: 100%;
            height: 100vh;
            margin: auto;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        main {
            width: 100%;
            height: 100%;
        }
        .slider {
			width: 100%;
            height: 720px;
        }
		.slider img {
			width: 100%;
			height: 100%;
		}
        img {
			width: 100%;
			vertical-align: top;
        }
    </style>
</head>
<body>
	<main>
        <header>
            <img src="./images/C_header.png">
        </header>
		<div class="slider" id="sliderBody">
			<div class="slide">
				<img draggable="false" src="./images/C_1.png">
			</div>
			<div class="slide">
				<img draggable="false" src="./images/C_2.png">
			</div>
			<div class="slide">
				<img draggable="false" src="./images/C_3.png">
			</div>
			<div class="slide">
				<img draggable="false" src="./images/C_4.png">
			</div>
			<!-- <div class="slide slide1"></div>
			<div class="slide slide2"></div>
			<div class="slide slide3"></div>
			<div class="slide slide4"></div> -->
			<div class="slider-navbar" id="sliderNavbar"></div>
		</div>
        <footer>
            <img src="./images/C_footer.png">
        </footer>
	</main>
	<script>
		let slides = document.getElementsByClassName('slide'),
			navbar = document.querySelector('#sliderNavbar'),
			transitionSpeed = 300,
			transitionValue = 'ease-in-out ' + transitionSpeed + 'ms',
			isSlideStop = true,
			isAutoplay = false,
			current = 0,
			timer;

		function switchNext() {
			if (isSlideStop) {
				if (isAutoplay) {
					clearInterval(timer);
					timer = setInterval(() => {
						switchNext();
					}, 3000);
				}
				isSlideStop = false;
				setTimeout(() => {isSlideStop = true;}, transitionSpeed * 1.2);
				let nextSlide = (current == slides.length - 1) ? 0 : (current + 1);
				slides[nextSlide].style.transition = 'none';
				slides[nextSlide].style.transform = 'translateX(100%)';
				slides[current].style.transition = transitionValue;
				setTimeout(() => {slides[nextSlide].style.transition = transitionValue}, 20);
				setTimeout(() => {
					slides[nextSlide].style.transform = 'translateX(0%)';
					slides[current].style.transform = 'translateX(-100%)';
				}, 40);
				setTimeout(() => {
					current++;
					if (current > slides.length - 1) {
						current = 0;
					}
					changeNavbarCurrent();
				}, 60);
			}
		}

		function switchPrev() {
			if (isSlideStop) {
				if (isAutoplay) {
					clearInterval(timer);
					timer = setInterval(() => {
						switchNext();
					}, 3000);
				}
				isSlideStop = false;
				setTimeout(() => {isSlideStop = true;}, transitionSpeed * 1.2);
				let prevSlide = (current == 0) ? (slides.length - 1) : (current - 1);
				slides[prevSlide].style.transition = 'none';
				slides[prevSlide].style.transform = 'translateX(-100%)';
				slides[current].style.transition = transitionValue;
				setTimeout(() => {slides[prevSlide].style.transition = transitionValue}, 20);
				setTimeout(() => {
					slides[prevSlide].style.transform = 'translateX(0%)';
					slides[current].style.transform = 'translateX(100%)';
				}, 40);
				setTimeout(() => {
					current--;
					if (current < 0) {
						current = slides.length - 1;
					}
					changeNavbarCurrent();
				}, 60);
			}
		}

		if (slides.length > 1) {
			for (let i = 0; i < slides.length; i++) {
				if (i != current) {
					slides[i].style.transform = 'translateX(100%)';
				}
			}
		}

		function changeNavbarCurrent() {
			document.querySelector('.slider-navbar_cur-btn').classList.remove('slider-navbar_cur-btn');
			navbarBtns[current].classList.add('slider-navbar_cur-btn');
		}

		for (let i = 0; i < slides.length; i++) {
			let sliderNavBtn = document.createElement('button');
			if (i == current) {
				sliderNavBtn.className = 'slider-navbar_cur-btn';
			}
			navbar.append(sliderNavBtn);
		}

		let navbarBtns = document.querySelectorAll('#sliderNavbar button');

		function switchSlideViaBar(clickedSlide) {
			if (clickedSlide != current && isSlideStop) {
				isSlideStop = false;
				setTimeout(() => {isSlideStop = true;}, transitionSpeed * 1.2);
				// 1 means clicked slide is in the right, -1 is in the left
				let curMove = (clickedSlide > current) ? -1 : 1,
					clickedMove = (curMove == 1) ? -1 : 1;
				slides[clickedSlide].style.transition = 'none';
				slides[clickedSlide].style.transform = 'translateX(' + (100 * clickedMove) + '%)';
				slides[current].style.transition = transitionValue;
				setTimeout(() => {slides[clickedSlide].style.transition = transitionValue}, 0);
				setTimeout(() => {
					slides[clickedSlide].style.transform = 'translateX(0%)';;
					slides[current].style.transform = 'translateX(' + (100 * curMove) + '%)';
				}, 1);
				setTimeout(() => {
					current = clickedSlide
					changeNavbarCurrent();
				}, 2);
			}
		}

		for (let i = 0; i < navbarBtns.length; i++) {
			navbarBtns[i].onclick = () => {
				switchSlideViaBar(i);
			};
		}

		if (isAutoplay) {
			navbar.classList.add('slider-navbar_autoplay');
			timer = setInterval(() => {
				switchNext();
			}, 3000);
		}

		let sliderBody = document.querySelector('#sliderBody'),
			pageBody = document.querySelector('body'),
			beginTouch = 0,
			isTouch = false;

		sliderBody.onmousedown = (event) => {
			beginTouch = event.clientX;
			isTouch = true;
		}

		sliderBody.ontouchstart = (event) => {
			beginTouch = event.changedTouches[0].clientX;
			isTouch = true;
		}

		pageBody.onmouseup = (event) => {
			if (isTouch) {
				let endTouch = event.clientX,
					isSwipe = Math.abs(beginTouch - endTouch) > 150 ? true : false;
				// console.log(beginTouch, endTouch);
				if (beginTouch < endTouch && isSwipe) {
					//console.log('to the left');
					switchPrev();
				}
				else if (beginTouch > endTouch && isSwipe) {
					//console.log('to the right');
					switchNext();
				}
				isTouch = false;
			}
		}

		pageBody.ontouchend = (event) => {
			if (isTouch) {
				let endTouch = event.changedTouches[0].clientX,
					isSwipe = Math.abs(beginTouch - endTouch) > 50 ? true : false;
				if (beginTouch < endTouch && isSwipe) {
					// console.log('to the left');
					switchPrev();
				}
				else if (beginTouch > endTouch && isSwipe) {
					// console.log('to the right');
					switchNext();
				}
				setTimeout(() => {isTouch = false}, 4);
			}
		}
	</script>
</body>
</html>
